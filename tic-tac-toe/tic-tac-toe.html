<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>○×ゲーム</title>
</head>
<body>
  <table border="3">
    <tbody>
      <tr class="1stLine">
        <td class="1stColumn diagonalLeft"></td>
        <td class="2ndCulomn"></td>
        <td class="3rdColumn diagonalRight"></td>
      </tr>
      <tr class="2ndLine">
        <td class="1stColumn"></td>
        <td class="2ndCulomn diagonalLeft diagonalRight"></td>
        <td class="3rdColumn"></td>
      </tr>
      <tr class="3rdLine">
        <td class="1stColumn diagonalRight"></td>
        <td class="2ndCulomn"></td>
        <td class="3rdColumn diagonalLeft"></td>
      </tr>
    </tbody>
  </table>
  <div class="judgement">
    <p class="cerclejud"></p>
    <p class="crossjud"></p>
  </div>
  <div class="button_wrapper">
    <button class="reset">RESET</button>
  </div>
</body>
<style>

  table{
    margin: auto;
  }

  td{
    width: 100px;
    height: 100px;
    position: relative;
  }

  td.cercle{
    background-image: url(img/cercle.png);
    background-repeat: no-repeat;
    background-size: cover;
  }

  td.cross{
    background-image: url(img/cross.png);
    background-repeat: no-repeat;
    background-size: cover;
  }

  .button_wrapper{
    text-align: center;
  }

  .reset{
    display: none;
    background: linear-gradient(45deg, #ffbb1e, #ff9158);
    font-size: 20px;
    padding: 5px 15px;
    border-radius: 10px;
    color: #fcfcfc;
    box-sizing: border-box;
    border: none;
  }

  .reset:hover{
    background: linear-gradient(45deg, #ffe5a8, #ffc8ac);
    cursor: pointer;
  }

  .win{
    color: red;
    font-size: 20px;
  }

  .lose{
    color: blue;
    font-size: 15px;
  }

  .judgement{
    margin: 20px 0;
    text-align: center;
  }

</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
  $(function(){

    var order = 0;
    var gamejud = true;
    var turn;

    if(order % 2 === 0){
      turn = "cercle";
    } else {
      turn = "cross";
    }

    function j(){
      var firstLineCercle = $("tbody").find(".1stLine").find(".cercle").length;
      console.log(first === 2);
    }

    function judgement() {

      var firstLine = $("tbody").find(".1stLine").find("."+turn+"").length;
      var secondLine = $("tbody").find(".2ndLine").find("."+turn+"").length;
      var thirdLine = $("tbody").find(".3rdLine").find("."+turn+"").length;
      var fistColumn = $("tbody").find(".1stColumn."+turn+"").length;
      var secondColumn = $("tbody").find(".2ndCulomn."+turn+"").length;
      var thirdColumn = $("tbody").find(".3rdColumn."+turn+"").length;
      var diagonalLeft = $("tbody").find(".diagonalLeft."+turn+"").length;
      var diagonalRight = $("tbody").find(".diagonalRight."+turn+"").length;

      if(firstLine === 3 || secondLine === 3 || thirdLine === 3 ||
         fistColumn === 3 || secondColumn === 3 || thirdColumn === 3 ||
         diagonalLeft === 3 || diagonalRight === 3){
        if(turn === "cercle"){
          $(".cerclejud").text("先手の勝利！");
          $(".cerclejud").addClass("win");
          $(".crossjud").text("後手の負け");
          $(".crossjud").addClass("lose");
          $(".reset").css("display", "inline-block");
          gamejud = false;
        } else if (turn === "cross"){
          $(".cerclejud").text("先手の負け");
          $(".cerclejud").addClass("lose");
          $(".crossjud").text("後手の勝利！");
          $(".crossjud").addClass("win");
          $(".reset").css("display", "inline-block");
          gamejud = false;
        }
      } else if($("tbody").find(".placed").length === 9) {
        $(".judgement").text("引き分けです……");
        $(".reset").css("display", "inline-block");
        gamejud = false;
        }
    }

    function computer(){
      $(this).off();
      var place = $("td").length - $(".placed").length;

      var firstLine = $("tbody").find(".1stLine").find(".cross").length;
      var secondLine = $("tbody").find(".2ndLine").find("."+turn+"").length;
      var thirdLine = $("tbody").find(".3rdLine").find("."+turn+"").length;
      var fistColumn = $("tbody").find(".1stColumn."+turn+"").length;
      var secondColumn = $("tbody").find(".2ndCulomn."+turn+"").length;
      var thirdColumn = $("tbody").find(".3rdColumn."+turn+"").length;
      var diagonalLeft = $("tbody").find(".diagonalLeft."+turn+"").length;
      var diagonalRight = $("tbody").find(".diagonalRight."+turn+"").length;

      //初手、中心が空いていれば
      if(order === 1){
        if(!$(".2ndLine").find(".2ndCulomn").hasClass("placed")){
          $(".2ndLine").find(".2ndCulomn").addClass("cross placed");
        } else {
          $(".1stLine").find(".1stColumn").addClass("cross placed");
        }
      } else if(order > 1){

        var random = Math.floor(Math.random()*place);

        firstLine === 2 ? $(".1stLine").not(".placed").addClass("cross placed") : 
        secondLine === 2 ? $(".2stLine").not(".placed").addClass("cross placed") : 
        thirdLine === 2 ? $(".3stLine").not(".placed").addClass("cross placed") : 
        fistColumn === 2 ? $(".1stColumn").not(".placed").addClass("cross placed") : 
        secondColumn === 2 ? $(".2ndColumn").not(".placed").addClass("cross placed") : 
        thirdColumn === 2 ? $(".3rdColumn").not(".placed").addClass("cross placed") : 
        diagonalLeft === 2 ? $(".diagonalLeft").not(".placed").addClass("cross placed") : 
        diagonalRight === 2 ? $(".diagonalRight").not(".placed").addClass("cross placed") : 
        $("td").not(".placed").eq(random).addClass("cross placed");
      }
    }

    $("td").on("click", function(){
      if($(this).hasClass("placed") || !gamejud){
        return false;
      } else {
        if (order % 2 === 0) {
          $(this).addClass("cercle placed");
          judgement();
        } else if( order % 2 === 1){
          computer();
          judgement();
        } else {
          //
        }
      }
      order ++;
    });

    $(".reset").on("click", function(){
      location.reload();
    })
  });
</script>
</html>